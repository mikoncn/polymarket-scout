<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>🎯 Polymarket Scout - 配置中心</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <div class="container">
      <!-- 头部 -->
      <header class="header">
        <div class="header-content">
          <h1>🎯 Polymarket Scout</h1>
          <p class="subtitle">Mikon AI Army 闪电侦察兵 - 配置中心</p>
        </div>
      </header>

      <!-- 主内容区 -->
      <main class="main-content">
        <div class="config-column">
        <!-- 配置面板 -->
        <section class="config-panel">
          <h2>⚙️ 侦察配置</h2>

          <!-- 方案预设管理 -->
          <div class="preset-bar">
            <div class="preset-control">
              <label for="presetSelect">📋 战术方案:</label>
              <select id="presetSelect">
                <option value="">-- 选择预设方案 --</option>
              </select>
            </div>
            <button id="savePresetBtn" class="btn btn-sm btn-outline">💾 另存为新方案</button>
          </div>

          <!-- 核心筛选规则 -->
          <div class="config-section">
            <h3>核心筛选规则</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="minVolume">最低成交量 (USD)</label>
                <input type="number" id="minVolume" placeholder="5000" />
                <span class="hint">过滤低活跃市场</span>
              </div>

              <div class="form-group">
                <label for="minProb">最低胜率 (0-1)</label>
                <input
                  type="number"
                  id="minProb"
                  step="0.01"
                  placeholder="0.15"
                />
                <span class="hint">默认 0.15 (15%)</span>
              </div>

              <div class="form-group">
                <label for="maxProb">最高胜率 (0-1)</label>
                <input
                  type="number"
                  id="maxProb"
                  step="0.01"
                  placeholder="0.85"
                />
                <span class="hint">默认 0.85 (85%)</span>
              </div>

              <div class="form-group">
                <label for="tag">品类标签</label>
                <div class="custom-select-wrapper" id="tagSelectWrapper">
                    <div class="custom-select-trigger">
                        <input 
                          type="text" 
                          id="tag" 
                          placeholder="选择或搜索品类..." 
                          autocomplete="off"
                        />
                        <span class="arrow">▼</span>
                    </div>
                    <ul class="custom-options" id="tagOptions">
                        <li data-value="">全局扫描</li>
                        <!-- 这里的选项将由 JS 动态加载 -->
                    </ul>
                </div>
                <span class="hint">点击选择或输入搜索</span>
              </div>
            </div>
          </div>

          <!-- 高级筛选 -->
          <div class="config-section">
            <h3>高级筛选（可选）</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="minLiquidity">最低流动性 (USD)</label>
                <input
                  type="number"
                  id="minLiquidity"
                  placeholder="留空不限制"
                />
                <span class="hint">排除订单簿深度不足的市场</span>
              </div>

              <div class="form-group">
                <label for="maxDays">结束日期倒计时（天）</label>
                <input type="number" id="maxDays" placeholder="留空不限制" />
                <span class="hint">仅看 X 天内结盘的市场</span>
              </div>

              <div class="form-group">
                <label for="search">关键词搜索</label>
                <input
                  type="text"
                  id="search"
                  placeholder="如: Trump, Bitcoin"
                />
                <span class="hint">标题中包含特定词</span>
              </div>

              <div class="form-group">
                <label for="exclude">排除关键词 (黑名单)</label>
                <input
                  type="text"
                  id="exclude"
                  placeholder="如: GTA, News (逗号分隔)"
                />
                <span class="hint">标题含任一词则屏蔽</span>
              </div>

              <div class="form-group">
                <label for="orderBy">排序策略</label>
                <select id="orderBy">
                  <option value="volume">成交量（Volume）</option>
                  <option value="liquidity">流动性（Liquidity）</option>
                  <option value="endDate">即将到期（EndDate）</option>
                  <option value="prob">胜率极端值（Prob）</option>
                </select>
                <span class="hint">结果排序依据</span>
              </div>
              
              <div class="form-group">
                <label for="fetchLimit">扫描深度 (Limit)</label>
                <input
                  type="number"
                  id="fetchLimit"
                  placeholder="200"
                  value="200"
                />
                <span class="hint">单次获取的市场数量 (狙击建议 2000+)</span>
              </div>
              
              <div class="form-group">
                <label for="runtimeLimit">运行限时（秒）</label>
                <input type="number" id="runtimeLimit" placeholder="30" />
                <span class="hint">脚本最大运行时间</span>
              </div>
            </div>
          </div>

          <!-- 操作按钮 -->
          <div class="action-buttons">
            <button id="saveBtn" class="btn btn-primary">💾 保存配置</button>
            <button id="scoutBtn" class="btn btn-success">🚀 启动侦察</button>
            <button id="resetBtn" class="btn btn-secondary">🔄 重置默认</button>
          </div>
        </section>

        <!-- ⚡ 自动化与推送配置 -->
        <section class="config-panel">
            <h2>⚡ 自动化与推送</h2>
            <div class="config-section">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="autoPreset">默认启动预设</label>
                        <select id="autoPreset">
                            <option value="">-- 跟随当前手动配置 --</option>
                            <!-- 动态加载 -->
                        </select>
                        <span class="hint">一键启动时使用的配置</span>
                    </div>

                    <div class="form-group">
                         <label for="webhookUrl">消息推送 (Webhook)</label>
                         <input type="text" id="webhookUrl" placeholder="https://discord.com/api/webhooks/..." />
                         <span class="hint">结果发送至 Discord/Slack/Telegram</span>
                    </div>
                </div>
                <div class="action-buttons" style="margin-top: 1rem;">
                    <button id="saveAutoBtn" class="btn btn-primary">💾 保存自动化配置</button>
                    <button id="testWebhookBtn" class="btn btn-sm btn-secondary">🔔 测试推送</button>
                </div>
            </div>
        </section>
        </div>

        <!-- 结果展示区 -->
        <section class="results-panel">
          <h2>📊 侦察结果</h2>
          <div id="resultsContainer" class="results-container">
            <div class="empty-state">
              <p>🎯 点击"启动侦察"开始扫描市场</p>
            </div>
          </div>
        </section>
      </main>

      <!-- 底部 -->
      <footer class="footer">
        <p>Mikon AI Army - 为 Vibe 而战 🚀</p>
      </footer>
    </div>

    <!-- 加载提示 -->
    <div id="loadingOverlay" class="loading-overlay hidden">
      <div class="loading-spinner"></div>
      <p>侦察进行中...</p>
    </div>

    <!-- 新增：保存方案弹窗 (替代原生 prompt) -->
    <div id="savePresetModal" class="loading-overlay hidden" style="background: rgba(0,0,0,0.8);">
        <div class="modal-box" style="background: #1e1e1e; padding: 2rem; border-radius: 12px; border: 1px solid #333; min-width: 300px; text-align: center;">
            <h3 style="margin-bottom: 1.5rem; color: #fff;">💾 另存为新方案</h3>
            <input type="text" id="newPresetName" placeholder="输入方案名称..." style="width: 100%; padding: 0.8rem; margin-bottom: 1.5rem; background: #2d2d2d; border: 1px solid #444; color: #fff; border-radius: 6px;">
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <button id="cancelPresetBtn" class="btn btn-secondary">取消</button>
                <button id="confirmPresetBtn" class="btn btn-primary">确认保存</button>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="notification hidden"></div>

    <script src="/static/app.js"></script>
  </body>
</html>
